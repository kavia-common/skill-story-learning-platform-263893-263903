{"is_source_file": true, "format": "JavaScript", "description": "This file implements a minimal typed API client for the Skill Story LMS frontend. It handles authentication, token management, API requests with error handling and refresh logic, and provides a set of exported functions for interacting with the backend API, including story retrieval, user profile management, journaling, and instructor-specific endpoints.", "external_files": ["fetch", "localStorage", "process.env"], "external_methods": ["localStorage.getItem", "localStorage.setItem", "localStorage.removeItem", "fetch", "console.log"], "published": ["getToken", "setToken", "api"], "classes": [], "methods": [{"name": "getToken()", "description": "Retrieve the stored bearer token from local storage.", "scope": "", "scopeKind": ""}, {"name": "setToken(token)", "description": "Store or remove the bearer token in local storage.", "scope": "", "scopeKind": ""}, {"name": "request(input, init = {}, allowRetry = true)", "description": "Unified fetch wrapper that handles JSON parsing, CORS, authorization headers, error handling, and token refresh on 401 responses.", "scope": "", "scopeKind": ""}, {"name": "health()", "description": "Health check endpoint to verify backend service status.", "scope": "api", "scopeKind": "class"}, {"name": "issueToken(xDemoUser)", "description": "Issue a demo token for testing or local use.", "scope": "api", "scopeKind": "class"}, {"name": "register(email, password, display_name = null)", "description": "Register a new user and receive authentication tokens.", "scope": "api", "scopeKind": "class"}, {"name": "login(email, password)", "description": "Authenticate user and receive tokens.", "scope": "api", "scopeKind": "class"}, {"name": "refresh(refresh_token)", "description": "Exchange a refresh token for a new access token.", "scope": "api", "scopeKind": "class"}, {"name": "me()", "description": "Fetch the current authenticated user's profile.", "scope": "api", "scopeKind": "class"}, {"name": "listStories", "description": "Retrieve list of stories, with fallback to demo data."}, {"name": "getStory", "description": "Retrieve metadata for a specific story."}, {"name": "getEpisode", "description": "Retrieve an episode by story ID and episode index, with fallback demo data."}, {"name": "submitChoice", "description": "Submit a user's choice for an episode, returning the next episode or progress."}, {"name": "getProgress", "description": "Get user's current XP and progression."}, {"name": "getProfile", "description": "Retrieve the user's profile information."}, {"name": "patchProfile", "description": "Update profile fields."}, {"name": "listJournal", "description": "Fetch journal entries."}, {"name": "createJournal", "description": "Create a new journal entry."}, {"name": "authorListStories", "description": "List stories for content authoring; handle missing backend gracefully."}, {"name": "authorCreateStory", "description": "Create a new story with provided payload."}, {"name": "authorUpdateStory", "description": "Update an existing story."}, {"name": "authorDeleteStory", "description": "Delete a story."}, {"name": "authorListEpisodes", "description": "List episodes of a story for authoring."}, {"name": "authorCreateEpisode", "description": "Create a new episode."}, {"name": "authorUpdateEpisode", "description": "Update an existing episode."}, {"name": "authorDeleteEpisode", "description": "Delete an episode."}, {"name": "authorListChoices", "description": "List choices for an episode."}, {"name": "authorCreateChoice", "description": "Create a new choice."}, {"name": "authorUpdateChoice", "description": "Update an existing choice."}, {"name": "authorDeleteChoice", "description": "Delete a choice."}, {"name": "authorListQuizQuestions", "description": "List quiz questions for an episode."}, {"name": "authorCreateQuizQuestion", "description": "Create a quiz question for an episode."}, {"name": "authorUpdateQuizQuestion", "description": "Update a quiz question."}, {"name": "authorDeleteQuizQuestion", "description": "Delete a quiz question."}, {"name": "getRefreshToken()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "setRefreshToken(token)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "tryRefresh()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "url(path)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["localStorage.getItem", "localStorage.setItem", "localStorage.removeItem", "fetch", "request", "tryRefresh", "setToken", "setRefreshToken"], "search-terms": ["API client", "JWT refresh", "token management", "story API", "authoring endpoints", "fallback demo data", "refresh token"], "state": 2, "file_id": 13, "knowledge_revision": 63, "git_revision": "2e68d724e06db65b15be2648839cfb63041cbefc", "revision_history": [{"27": ""}, {"38": "8eab12752d7d4437e9e03637060e0207f5252480"}, {"43": "9bd30b60b90ceddc775a9c5830865317313ac7d7"}, {"53": "c3f5d665e0b7fe21bad9616461f1b51c9713863a"}, {"55": "c3f5d665e0b7fe21bad9616461f1b51c9713863a"}, {"58": "2e68d724e06db65b15be2648839cfb63041cbefc"}, {"63": "2e68d724e06db65b15be2648839cfb63041cbefc"}], "ctags": [{"_type": "tag", "name": "1", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   1: [$/", "language": "JavaScript", "kind": "property", "scope": "FALLBACK_EPISODES", "scopeKind": "class"}, {"_type": "tag", "name": "2", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   2: [$/", "language": "JavaScript", "kind": "property", "scope": "FALLBACK_EPISODES", "scopeKind": "class"}, {"_type": "tag", "name": "API_BASE_URL", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ const API_BASE_URL = process.env.REACT_APP_API_BASE_URL || \"\";$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "DEMO_USER", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ const DEMO_USER = process.env.REACT_APP_DEMO_USER || \"\";$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "FALLBACK_EPISODES", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ const FALLBACK_EPISODES = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "FALLBACK_STORIES", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ const FALLBACK_STORIES = [$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "REFRESH_KEY", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ const REFRESH_KEY = \"skillstory.refresh_token\";$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "TOKEN_KEY", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ const TOKEN_KEY = \"skillstory.token\";$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "api", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ export const api = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "demo", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^       const demo = (FALLBACK_EPISODES[sid] || [])[idx];$/", "language": "JavaScript", "kind": "constant", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "getRefreshToken", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ function getRefreshToken() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "getToken", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ export function getToken() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "health", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   async health() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "idx", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^       const idx = Number(epIndex);$/", "language": "JavaScript", "kind": "constant", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "issueToken", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   async issueToken(xDemoUser) {$/", "language": "JavaScript", "kind": "method", "signature": "(xDemoUser)", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "login", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   async login(email, password) {$/", "language": "JavaScript", "kind": "method", "signature": "(email, password)", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "me", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   async me() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "path", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^     const path =$/", "language": "JavaScript", "kind": "constant", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "refresh", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   async refresh(refresh_token) {$/", "language": "JavaScript", "kind": "method", "signature": "(refresh_token)", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "register", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   async register(email, password, display_name = null) {$/", "language": "JavaScript", "kind": "method", "signature": "(email, password, display_name = null)", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "request", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ async function request(input, init = {}, allowRetry = true) {$/", "language": "JavaScript", "kind": "function", "signature": "(input, init = {}, allowRetry = true)"}, {"_type": "tag", "name": "setRefreshToken", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ function setRefreshToken(token) {$/", "language": "JavaScript", "kind": "function", "signature": "(token)"}, {"_type": "tag", "name": "setToken", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   setToken,$/", "language": "JavaScript", "kind": "field", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "setToken", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ export function setToken(token) {$/", "language": "JavaScript", "kind": "function", "signature": "(token)"}, {"_type": "tag", "name": "sid", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^       const sid = Number(storyId);$/", "language": "JavaScript", "kind": "constant", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "tryRefresh", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ async function tryRefresh() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ function url(path) {$/", "language": "JavaScript", "kind": "function", "signature": "(path)"}], "hash": "1d516f11c353c78b8108bdca7785adbd", "format-version": 4, "code-base-name": "skill_story_frontend", "filename": "skill_story_frontend/src/api/client.js", "fields": [{"name": "1: [", "scope": "FALLBACK_EPISODES", "scopeKind": "class", "description": "unavailable"}, {"name": "2: [", "scope": "FALLBACK_EPISODES", "scopeKind": "class", "description": "unavailable"}, {"name": "setToken,", "scope": "api", "scopeKind": "class", "description": "unavailable"}]}