{"is_source_file": true, "format": "JavaScript", "description": "Source code for a minimal API client to interact with the Skill Story LMS backend. Provides functions for authentication, story retrieval, progress updates, profile management, journal entries, and internal token handling with support for refresh tokens and fallback demo data.", "external_files": ["node-fetch", "localStorage", "process.env"], "external_methods": ["fetch", "localStorage.getItem", "localStorage.setItem", "localStorage.removeItem"], "published": ["api", "getToken", "setToken"], "classes": [], "methods": [{"name": "getToken()", "description": "Retrieve the stored bearer token from local storage.", "scope": "", "scopeKind": ""}, {"name": "setToken(token)", "description": "Save or remove the bearer token in local storage.", "scope": "", "scopeKind": ""}, {"name": "health()", "description": "Checks the health status of the backend service.", "scope": "api", "scopeKind": "class"}, {"name": "issueToken(xDemoUser)", "description": "Issues a short-lived token for demo purposes, optionally with a demo user header.", "scope": "api", "scopeKind": "class"}, {"name": "register(email, password, display_name = null)", "description": "Registers a new user and sets authentication tokens.", "scope": "api", "scopeKind": "class"}, {"name": "login(email, password)", "description": "Authenticates a user with email and password, setting tokens.", "scope": "api", "scopeKind": "class"}, {"name": "refresh(refresh_token)", "description": "Refreshes the access token using a refresh token.", "scope": "api", "scopeKind": "class"}, {"name": "me()", "description": "Retrieves the current authenticated user's profile.", "scope": "api", "scopeKind": "class"}, {"name": "listStories", "description": "Fetches list of stories or provides fallback demo stories."}, {"name": "getStory", "description": "Retrieves metadata about a specific story."}, {"name": "getEpisode", "description": "Retrieves a specific episode by story ID and index, with fallback demo episodes."}, {"name": "submitChoice", "description": "Submits a choice for the current episode and returns the next episode/progress."}, {"name": "getProgress", "description": "Returns the user's progress, XP, and current position."}, {"name": "getProfile", "description": "Fetches the current user's profile data."}, {"name": "patchProfile", "description": "Updates the user's profile data."}, {"name": "listJournal", "description": "Lists journal entries."}, {"name": "createJournal", "description": "Creates a new journal entry."}, {"name": "getRefreshToken()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "request(input, init = {}, allowRetry = true)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "setRefreshToken(token)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "tryRefresh()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "url(path)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["fetch", "localStorage.getItem", "localStorage.setItem", "localStorage.removeItem", "request", "tryRefresh", "setToken", "setRefreshToken", "getToken", "getRefreshToken"], "search-terms": ["API client", "auth tokens", "story episodes", "progress", "fallback demo", "refresh token", "local storage", "React environment", "fetch wrapper"], "state": 2, "file_id": 13, "knowledge_revision": 55, "git_revision": "c3f5d665e0b7fe21bad9616461f1b51c9713863a", "revision_history": [{"27": ""}, {"38": "8eab12752d7d4437e9e03637060e0207f5252480"}, {"43": "9bd30b60b90ceddc775a9c5830865317313ac7d7"}, {"53": "c3f5d665e0b7fe21bad9616461f1b51c9713863a"}, {"55": "c3f5d665e0b7fe21bad9616461f1b51c9713863a"}], "ctags": [{"_type": "tag", "name": "1", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   1: [$/", "language": "JavaScript", "kind": "property", "scope": "FALLBACK_EPISODES", "scopeKind": "class"}, {"_type": "tag", "name": "2", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   2: [$/", "language": "JavaScript", "kind": "property", "scope": "FALLBACK_EPISODES", "scopeKind": "class"}, {"_type": "tag", "name": "API_BASE_URL", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ const API_BASE_URL = process.env.REACT_APP_API_BASE_URL || \"\";$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "DEMO_USER", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ const DEMO_USER = process.env.REACT_APP_DEMO_USER || \"\";$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "FALLBACK_EPISODES", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ const FALLBACK_EPISODES = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "FALLBACK_STORIES", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ const FALLBACK_STORIES = [$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "REFRESH_KEY", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ const REFRESH_KEY = \"skillstory.refresh_token\";$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "TOKEN_KEY", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ const TOKEN_KEY = \"skillstory.token\";$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "api", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ export const api = {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "demo", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^       const demo = (FALLBACK_EPISODES[sid] || [])[idx];$/", "language": "JavaScript", "kind": "constant", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "getRefreshToken", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ function getRefreshToken() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "getToken", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ export function getToken() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "health", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   async health() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "idx", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^       const idx = Number(epIndex);$/", "language": "JavaScript", "kind": "constant", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "issueToken", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   async issueToken(xDemoUser) {$/", "language": "JavaScript", "kind": "method", "signature": "(xDemoUser)", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "login", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   async login(email, password) {$/", "language": "JavaScript", "kind": "method", "signature": "(email, password)", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "me", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   async me() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "path", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^     const path =$/", "language": "JavaScript", "kind": "constant", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "refresh", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   async refresh(refresh_token) {$/", "language": "JavaScript", "kind": "method", "signature": "(refresh_token)", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "register", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   async register(email, password, display_name = null) {$/", "language": "JavaScript", "kind": "method", "signature": "(email, password, display_name = null)", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "request", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ async function request(input, init = {}, allowRetry = true) {$/", "language": "JavaScript", "kind": "function", "signature": "(input, init = {}, allowRetry = true)"}, {"_type": "tag", "name": "setRefreshToken", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ function setRefreshToken(token) {$/", "language": "JavaScript", "kind": "function", "signature": "(token)"}, {"_type": "tag", "name": "setToken", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^   setToken,$/", "language": "JavaScript", "kind": "field", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "setToken", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ export function setToken(token) {$/", "language": "JavaScript", "kind": "function", "signature": "(token)"}, {"_type": "tag", "name": "sid", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^       const sid = Number(storyId);$/", "language": "JavaScript", "kind": "constant", "scope": "api", "scopeKind": "class"}, {"_type": "tag", "name": "tryRefresh", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ async function tryRefresh() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/skill-story-learning-platform-263893-263903/skill_story_frontend/src/api/client.js", "pattern": "/^ function url(path) {$/", "language": "JavaScript", "kind": "function", "signature": "(path)"}], "hash": "2cc22f21c341617b74e5eda469a76262", "format-version": 4, "code-base-name": "skill_story_frontend", "filename": "skill_story_frontend/src/api/client.js", "fields": [{"name": "1: [", "scope": "FALLBACK_EPISODES", "scopeKind": "class", "description": "unavailable"}, {"name": "2: [", "scope": "FALLBACK_EPISODES", "scopeKind": "class", "description": "unavailable"}, {"name": "setToken,", "scope": "api", "scopeKind": "class", "description": "unavailable"}]}